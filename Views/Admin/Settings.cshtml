@model IEnumerable<FYP.Models.Settings>
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<FYP.Localization.SharedResource> L
@{
    ViewData["Title"] = L["Settings"];
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.SearchPlaceholder = "Search settings...";
    ViewBag.SearchInputId = "SettingsSearchInput";
}

<div class="container-custom" style="padding: var(--spacing-3xl) var(--spacing-2xl); max-width: 1400px; margin: 0 auto;">
    <partial name="~/Views/Shared/_BackButton.cshtml" model="@Url.Action("Index","Admin")" />

    @if (TempData["Success"] != null)
    {
        { ViewData["Type"] = "success"; ViewData["Message"] = TempData["Success"]; }
        <partial name="~/Views/Shared/_AlertMessage.cshtml" />
    }

    @if (TempData["Error"] != null)
    {
        { ViewData["Type"] = "error"; ViewData["Message"] = TempData["Error"]; }
        <partial name="~/Views/Shared/_AlertMessage.cshtml" />
    }

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center" style="margin-bottom: var(--spacing-2xl); padding: 0 var(--spacing-md);">
        <div>
            <h1 class="gold-heading" style="font-size: 2.5rem; margin-bottom: var(--spacing-xs);">
                @ViewData["Title"]
            </h1>
            <p style="color: var(--text-secondary); font-size: 1rem;">
                @L["Manage restaurant configuration settings"]
            </p>
        </div>

        <div class="settings-header-actions">
            <partial name="~/Views/Shared/_Search.cshtml" />
        </div>
    </div>

    @if (Model != null && Model.Any())
    {
        var stats = new[] {
            new FYP.ViewModels.AdminStatViewModel { Icon = "settings", Number = Model.Count().ToString(), Label = L["Total Settings"], ColorClass = "stat-cube-gold" },
        };

        <!-- Stats Row -->
        <div class="stats-row-container">
            @foreach (var s in stats) { @Html.Partial("~/Views/Shared/_StatCube.cshtml", s) }
        </div>

        <!-- Settings Cards Grid (styled like table cards) -->
        <div class="row g-4" style="padding: 0 var(--spacing-md); margin-top: var(--spacing-xl);">
            @foreach (var setting in Model.OrderBy(s => s.Key))
            {
                <div class="col-md-6 col-lg-4 col-xl-3">
                    <div class="table-card">
                        <div class="table-card-header">
                            <div style="display:flex; align-items:center; gap:var(--spacing-md);">
                                <div class="table-number-badge" style="width:auto; padding:0.5rem 0.75rem; background:transparent; box-shadow:none; border-radius:var(--radius-md); border:1px solid transparent;">
                                    <span class="material-symbols-outlined">tune</span>
                                </div>
                                <div>
                                    <h3 class="admin-cube-title" style="font-size:1.125rem; margin:0;">@setting.Key</h3>
                                    <div style="color:var(--text-secondary); font-size:0.875rem;">@setting.Value</div>
                                </div>
                            </div>

                            <div class="table-badges">
                                @if (!string.IsNullOrWhiteSpace(setting.Value))
                                {
                                    <span class="table-status-badge status-available">@L["Filled"]</span>
                                }
                                else
                                {
                                    <span class="table-status-badge status-unavailable">@L["Empty"]</span>
                                }
                            </div>
                        </div>

                        <div class="table-card-body">
                            <div class="table-detail-item">
                                <div class="table-detail-icon">
                                    <span class="material-symbols-outlined">calendar_month</span>
                                </div>
                                <div>
                                    <div class="table-detail-value">@setting.UpdatedAt.ToString("MMM dd, yyyy")</div>
                                </div>
                            </div>
                        </div>

                        <div class="table-card-footer">
                            <a class="btn btn-sm btn-outline-primary" href="@Url.Action("EditSetting", "Admin", new { id = setting.SettingsID })">
                                <span class="material-symbols-outlined" style="font-size: 1rem; vertical-align: middle;">edit</span>
                                <span class="ms-1">@L["Edit"]</span>
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="empty-state" style="margin-top: var(--spacing-3xl); padding: var(--spacing-3xl) var(--spacing-2xl);">
            <span class="material-symbols-outlined empty-state-icon">settings_suggest</span>
            <h3 style="margin-top: var(--spacing-xl); margin-bottom: var(--spacing-md);">@L["No Settings Yet"]</h3>
            <p style="margin-bottom: var(--spacing-xl);">@L["No settings are configured."]</p>
        </div>
    }
</div>

@section Scripts {
    <script>
        // The _Search partial includes its own script section; no additional JS required here.
    </script>
}
