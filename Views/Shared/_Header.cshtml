@using Microsoft.AspNetCore.Identity
@using FYP.Models

@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

<header class="site-header">
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <!-- Brand Logo -->
            <a class="navbar-brand" asp-controller="Home" asp-action="Landing">
                <svg class="brand-icon" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Restaurant Logo">
                    <circle cx="32" cy="32" r="30" fill="currentColor" opacity="0.15" />
                    <path d="M20 14c.6 0 1 .4 1 1v18.5c0 3.9 2.6 6.7 5.2 7.9V14.9c0-.5.4-.9.9-.9h.1c.5 0 .9.4.9.9v26.1c0 .5.4.9.9.9h.1c.5 0 .9-.4.9-.9V14.9c0-.5.4-.9.9-.9h.1c.5 0 .9.4.9.9v26.5c1.9-1.5 3.2-4.1 3.2-7.9V15c0-.6.4-1 1-1s1 .4 1 1v18.5c0 5.7-3.1 9.3-7.2 10.6v6.9c0 .6-.4 1-1 1h-2c-.6 0-1-.4-1-1v-6.9c-4.1-1.3-7.2-4.9-7.2-10.6V15c0-.6.4-1 1-1Zm24.1 6.2c-2.2 0-4 1.8-4 4v12.4c0 2.7 1.6 5.1 4 6.2v6.6c0 .6.4 1 1 1h2c.6 0 1-.4 1-1v-6.6c2.4-1.1 4-3.5 4-6.2V24.2c0-2.2-1.8-4-4-4-1.1 0-2 .4-2.8 1.2-.8-.8-1.7-1.2-2.8-1.2Z" fill="currentColor" />
                </svg>
                <span>@L["BrandName"]</span>
            </a>

            <!-- Mobile Toggle Button -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar"
                    aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="material-symbols-outlined">menu</span>
            </button>

            <div class="collapse navbar-collapse ms-auto" id="mainNavbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" asp-controller="Home" asp-action="AboutUs">@L["About Us"]</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" asp-controller="Home" asp-action="ContactUs">@L["Contact"]</a>
                    </li>
                </ul>
                
                <!-- Language Switch -->
                <label class="lang-switch">
                    <span class="sr-only">@L["Language"]</span>
                    <select id="langSwitch" aria-label="@L["Language"]" class="form-select">
                        <option value="en">@L["English"]</option>
                        <option value="fr">@L["French"]</option>
                    </select>
                </label>

                <!-- Theme Toggle Button -->
                <button class="theme-toggle" type="button" aria-label="Toggle theme">
                    <span class="theme-toggle-sun material-symbols-outlined" style="display: none;">light_mode</span>
                    <span class="theme-toggle-moon material-symbols-outlined">dark_mode</span>
                </button>
            </div>
        </div>
    </nav>
</header>

<script>
    (function () {
        const setLangValue = (iso) => {
            const desktopSwitch = document.getElementById('langSwitch');
            if (desktopSwitch) desktopSwitch.value = iso;
        };

        const addChangeListener = (elementId) => {
            const langSwitch = document.getElementById(elementId);
            if (langSwitch) {
                langSwitch.addEventListener('change', function () {
                    const lang = this.value;
                    const returnUrl = '@Context.Request.Path@Context.Request.QueryString';

                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '@Url.Action("ChangeLanguage", "Home")';

                    const langInput = document.createElement('input');
                    langInput.type = 'hidden';
                    langInput.name = 'lang';
                    langInput.value = lang;

                    const returnUrlInput = document.createElement('input');
                    returnUrlInput.type = 'hidden';
                    returnUrlInput.name = 'returnUrl';
                    returnUrlInput.value = returnUrl;

                    form.appendChild(langInput);
                    form.appendChild(returnUrlInput);
                    document.body.appendChild(form);
                    form.submit();
                });
            }
        };

        // Initialize and setup language detection
        const cookieName = '.AspNetCore.Culture';
        const cookie = document.cookie.split('; ').find(x => x.startsWith(cookieName + '='));
        const current = cookie ? decodeURIComponent(cookie.split('=')[1]) : '';
        const match = /c=([a-z]{2})\|uic=([a-z]{2})/i.exec(current);
        const iso = match ? match[1] : 'en';

        setLangValue(iso);
        addChangeListener('langSwitch');
    })();
</script>