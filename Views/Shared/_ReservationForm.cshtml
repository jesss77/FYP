@{
    var showGuestName = (ViewData["ShowGuestName"] as bool?) ?? false;
    var formController = ViewData["FormController"]?.ToString() ?? "Customer";
}

<div class="content-container">
    <h2 class="gold-heading">Make a Reservation</h2>
    <hr class="gold-hr" />

    <form asp-controller="@formController" asp-action="Reserve" method="post">
        @Html.AntiForgeryToken()
        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label">Party Size</label>
                <input name="PartySize" type="number" min="1" max="20" step="1" class="form-control" placeholder="e.g. 2" required />
            </div>

            <div class="col-md-4">
                <label class="form-label">Date</label>
                <input name="ReservationDate" type="date" class="form-control" required min="@DateTime.UtcNow.ToString("yyyy-MM-dd")" />
            </div>

            <div class="col-md-4">
                <label class="form-label">Time</label>
                <input name="ReservationTime" type="time" class="form-control" required />
            </div>
        </div>

        @if (showGuestName)
        {
            <div class="mt-3">
                <label class="form-label">Name for Reservation</label>
                <input name="ReservationName" type="text" class="form-control" placeholder="Your name" required />
            </div>
        }

        <div class="mt-3">
            <label class="form-label">Notes (optional)</label>
            <textarea name="Notes" class="form-control" rows="3" placeholder="Allergies, seating preference, occasion..."></textarea>
        </div>

        <div class="mt-3">
            <button class="btn btn-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#moreOptions" aria-expanded="false" aria-controls="moreOptions">
                More Options
            </button>
        </div>

        <div class="collapse mt-3" id="moreOptions">
            <div class="row">
                <div class="col-md-6">
                    <label class="form-label">Duration</label>
                    <select name="Duration" class="form-select">
                        <option value="">Default (auto)</option>
                        <option value="45">45 minutes</option>
                        <option value="60">1 hour</option>
                        <option value="90">1 hour 30 minutes</option>
                        <option value="120">2 hours</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-confirm">Confirm Reservation</button>
        </div>
    </form>
</div>

<script>
    (function () {
        const dateInput = document.querySelector('input[name="ReservationDate"]');
        const timeInput = document.querySelector('input[name="ReservationTime"]');
        if (!dateInput || !timeInput) return;

        const now = new Date();
        const pad = (n) => n.toString().padStart(2, '0');
        const todayStr = `${now.getUTCFullYear()}-${pad(now.getUTCMonth() + 1)}-${pad(now.getUTCDate())}`;
        const currentTimeStr = `${pad(now.getUTCHours())}:${pad(now.getUTCMinutes())}`;

        dateInput.setAttribute('min', todayStr);

        function adjustTimeMin() {
            if (!dateInput.value) return;
            if (dateInput.value === todayStr) {
                timeInput.setAttribute('min', currentTimeStr);
            } else {
                timeInput.removeAttribute('min');
            }
        }

        dateInput.addEventListener('change', adjustTimeMin);
        adjustTimeMin();
    })();
</script>


