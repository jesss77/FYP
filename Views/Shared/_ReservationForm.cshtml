@{
    var showGuestName = (ViewData["ShowGuestName"] as bool?) ?? false;
    var formController = ViewData["FormController"]?.ToString() ?? "Customer";
}

<div class="content-container">
    <h2 class="gold-heading">@L["Make a Reservation"]</h2>
    <hr class="gold-hr" />

    <form asp-controller="@formController" asp-action="Reserve" method="post">
        @Html.AntiForgeryToken()
        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label">@L["Party Size"]</label>
                <input name="PartySize" type="number" min="1" max="20" step="1" class="form-control" placeholder="e.g. 2" required />
            </div>

            <div class="col-md-4">
                <label class="form-label">@L["Date"]</label>
                <input name="ReservationDate" type="date" class="form-control" required min="@DateTime.UtcNow.ToString("yyyy-MM-dd")" />
            </div>

            <div class="col-md-4">
                <label class="form-label">@L["Time"]</label>
                <input name="ReservationTime" type="time" class="form-control" required />
            </div>
        </div>

@if (showGuestName)
{
    <div class="row g-3 mt-1">
        <div class="col-md-4">
            <label class="form-label">@L["Full Name"]</label>
            <input name="GuestName" type="text" class="form-control" placeholder="@L["Your name"]" required />
        </div>
        <div class="col-md-4">
            <label class="form-label">@L["Email"]</label>
            <input name="GuestEmail" type="email" class="form-control" placeholder="name@example.com" required />
            <small class="form-text text-muted">
                @L["We will use your email to send your reservation confirmation. See our {0} for details.", @Html.ActionLink(L["Privacy Policy"].Value, "Privacy", "Home")]
            </small>
        </div>
        <div class="col-md-4">
            <label class="form-label">@L["Phone"]</label>
            <input name="GuestPhone" type="tel" class="form-control" placeholder="+1 555 123 4567" />
        </div>
    </div>
}

        <div class="mt-3">
            <label class="form-label">@L["Notes (optional)"]</label>
            <textarea name="Notes" class="form-control" rows="3" placeholder="Allergies, seating preference, occasion..."></textarea>
        </div>

        <div class="mt-3">
            <button class="btn btn-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#moreOptions" aria-expanded="false" aria-controls="moreOptions">
                @L["More Options"]
            </button>
        </div>

        <div class="collapse mt-3" id="moreOptions">
            <div class="row">
                <div class="col-md-6">
                    <label class="form-label">@L["Duration"]</label>
                    <select name="Duration" class="form-select">
                        <option value="">@L["Default (auto)"]</option>
                        <option value="45">@L["45 minutes"]</option>
                        <option value="60">@L["1 hour"]</option>
                        <option value="90">@L["1 hour 30 minutes"]</option>
                        <option value="120">@L["2 hours"]</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-confirm">@L["Confirm Reservation"]</button>
        </div>
    </form>
</div>

<script>
    (function () {
        const dateInput = document.querySelector('input[name="ReservationDate"]');
        const timeInput = document.querySelector('input[name="ReservationTime"]');
        if (!dateInput || !timeInput) return;

        const now = new Date();
        const pad = (n) => n.toString().padStart(2, '0');
        const todayStr = `${now.getUTCFullYear()}-${pad(now.getUTCMonth() + 1)}-${pad(now.getUTCDate())}`;
        const currentTimeStr = `${pad(now.getUTCHours())}:${pad(now.getUTCMinutes())}`;

        dateInput.setAttribute('min', todayStr);

        function adjustTimeMin() {
            if (!dateInput.value) return;
            if (dateInput.value === todayStr) {
                timeInput.setAttribute('min', currentTimeStr);
            } else {
                timeInput.removeAttribute('min');
            }
        }

        dateInput.addEventListener('change', adjustTimeMin);
        adjustTimeMin();
    })();
</script>


