@{
    var showGuestName = (ViewData["ShowGuestName"] as bool?) ?? false;
    var formController = ViewData["FormController"]?.ToString() ?? "Customer";
}

<div class="content-container">
    <h2 class="gold-heading">@L["Make a Reservation"]</h2>
    <hr class="gold-hr" />

    <form asp-controller="@formController" asp-action="Reserve" method="post">
        @Html.AntiForgeryToken()
        <div class="form-group">
            <label class="form-label">@L["Party Size"]</label>
            <div class="party-size-buttons">
                <button type="button" class="party-size-btn active" data-size="1">1</button>
                <button type="button" class="party-size-btn" data-size="2">2</button>
                <button type="button" class="party-size-btn" data-size="3">3</button>
                <button type="button" class="party-size-btn" data-size="4">4</button>
                <button type="button" class="party-size-btn" data-size="5">5</button>
                <button type="button" class="party-size-btn" data-size="6">6</button>
                <button type="button" class="party-size-btn" data-size="7">7</button>
                <button type="button" class="party-size-btn" data-size="8">8</button>
                <button type="button" class="party-size-btn" data-size="9">9+</button>
            </div>
            <input name="PartySize" type="hidden" id="partySizeInput" value="1" required />
        </div>
        
        <div class="row g-3">

            <div class="col-md-4">
                <label class="form-label">@L["Date"]</label>
                <input name="ReservationDate" type="date" class="form-control" required min="@DateTime.UtcNow.ToString("yyyy-MM-dd")" />
            </div>

            <div class="col-md-4">
                <label class="form-label">@L["Time"]</label>
                <input name="ReservationTime" type="time" class="form-control" required />
            </div>

            <div class="col-md-4">
                <label class="form-label">@L["Duration"]</label>
                <select name="Duration" class="form-select">
                    <option value="">@L["Default (auto)"]</option>
                    <option value="45">@L["45 minutes"]</option>
                    <option value="60">@L["1 hour"]</option>
                    <option value="90">@L["1 hour 30 minutes"]</option>
                    <option value="120">@L["2 hours"]</option>
                </select>
            </div>
        </div>

@if (showGuestName)
{
    <div class="row g-3 mt-1">
        <div class="col-md-4">
            <label class="form-label">@L["Full Name"]</label>
            <input name="GuestName" type="text" class="form-control" placeholder="@L["Your name"]" required />
        </div>
        <div class="col-md-4">
            <label class="form-label">@L["Email"]</label>
            <input name="GuestEmail" type="email" class="form-control" placeholder="name@example.com" required />
            <small class="form-text text-muted">
                @L["We will use your email to send your reservation confirmation. See our {0} for details.", @Html.ActionLink(L["Privacy Policy"].Value, "Privacy", "Home")]
            </small>
        </div>
        <div class="col-md-4">
            <label class="form-label">@L["Phone"]</label>
            <input name="GuestPhone" type="tel" class="form-control" placeholder="+1 555 123 4567" />
        </div>
    </div>
}

        <div class="mt-3">
            <label class="form-label">@L["Notes (optional)"]</label>
            <textarea name="Notes" class="form-control" rows="3" placeholder="Allergies, seating preference, occasion..."></textarea>
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-confirm">@L["Confirm Reservation"]</button>
        </div>
    </form>
</div>

<script>
    (function () {
        // Party size buttons
        const partySizeButtons = document.querySelectorAll('.party-size-btn');
        const partySizeInput = document.getElementById('partySizeInput');
        
        partySizeButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                partySizeButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const size = this.dataset.size;
                partySizeInput.value = size === '9' ? '9' : size;
            });
        });

        // Date and time validation
        const dateInput = document.querySelector('input[name="ReservationDate"]');
        const timeInput = document.querySelector('input[name="ReservationTime"]');
        if (!dateInput || !timeInput) return;

        const now = new Date();
        const pad = (n) => n.toString().padStart(2, '0');
        const todayStr = `${now.getUTCFullYear()}-${pad(now.getUTCMonth() + 1)}-${pad(now.getUTCDate())}`;
        const currentTimeStr = `${pad(now.getUTCHours())}:${pad(now.getUTCMinutes())}`;

        dateInput.setAttribute('min', todayStr);

        function adjustTimeMin() {
            if (!dateInput.value) return;
            if (dateInput.value === todayStr) {
                timeInput.setAttribute('min', currentTimeStr);
            } else {
                timeInput.removeAttribute('min');
            }
        }

        dateInput.addEventListener('change', adjustTimeMin);
        adjustTimeMin();
    })();
</script>


