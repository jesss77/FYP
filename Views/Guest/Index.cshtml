@using Microsoft.Extensions.Localization
@inject IStringLocalizer<FYP.Localization.SharedResource> L
@{
    ViewData["Title"] = L["Guest Reservation"];
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="center-container">
    <div class="register-form" style="max-width: 700px;">
        <partial name="~/Views/Shared/_BackButton.cshtml" model="@Url.Action("Index","Home")" />

        @if (TempData["Success"] != null)
        {
            { ViewData["Type"] = "success"; ViewData["Message"] = TempData["Success"]; }
            <partial name="~/Views/Shared/_AlertMessage.cshtml" />
        }

        @if (TempData["Error"] != null)
        {
            { ViewData["Type"] = "error"; ViewData["Message"] = TempData["Error"]; }
            <partial name="~/Views/Shared/_AlertMessage.cshtml" />
        }

        @if (TempData["Message"] != null)
        {
            { ViewData["Type"] = "success"; ViewData["Message"] = TempData["Message"]; }
            <partial name="~/Views/Shared/_AlertMessage.cshtml" />
        }

        <!-- Header -->
        <div style="margin-bottom: var(--spacing-xl); text-align: center;">
            <h1 class="gold-heading" style="font-size: 2rem; margin-bottom: var(--spacing-xs);">
                @L["Make a Reservation"]
            </h1>
            <p style="color: var(--text-secondary);">
                @L["We look forward to welcoming you. Please provide the following details to secure your reservation."]
            </p>
        </div>

        <hr class="gold-hr" />

        <!-- Reservation Form (copied from MakeReservation + guest fields) -->
        <form asp-controller="Guest" asp-action="Reserve" method="post">
            @Html.AntiForgeryToken()

            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label fw-semibold">
                        <span class="material-symbols-outlined" style="vertical-align: middle; font-size: 1.125rem; margin-right: 0.25rem;">calendar_today</span>
                        @L["Date"] <span style="color: var(--color-primary-red);">*</span>
                    </label>
                    <input name="ReservationDate" type="date" class="form-control" required 
                           min="@DateTime.Now.ToString("yyyy-MM-dd")" 
                           id="reservationDateInput"
                           lang="en-GB" />
                    <small style="display: block; color: var(--text-muted); margin-top: var(--spacing-xs); font-size: 0.75rem;">
                        ?? Format: DD/MM/YYYY
                    </small>
                </div>

                <div class="col-md-6">
                    <label class="form-label fw-semibold">
                        <span class="material-symbols-outlined" style="vertical-align: middle; font-size: 1.125rem; margin-right: 0.25rem;">schedule</span>
                        @L["Time"] <span style="color: var(--color-primary-red);">*</span>
                    </label>
                    <input name="ReservationTime" type="time" class="form-control" required />
                </div>
            </div>

            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label fw-semibold">
                        <span class="material-symbols-outlined" style="vertical-align: middle; font-size: 1.125rem; margin-right: 0.25rem;">groups</span>
                        @L["Party Size"] <span style="color: var(--color-primary-red);">*</span>
                    </label>
                    <input name="PartySize" type="number" min="1" max="20" class="form-control" 
                           placeholder="Number of guests" value="2" required />
                </div>

                <div class="col-md-6">
                    <label class="form-label fw-semibold">
                        <span class="material-symbols-outlined" style="vertical-align: middle; font-size: 1.125rem; margin-right: 0.25rem;">timer</span>
                        @L["Duration"] (@L["minutes"])
                    </label>
                    <select name="Duration" class="form-control">
                        <option value="90">90 @L["minutes"] (@L["Standard"])</option>
                        <option value="120">120 @L["minutes"]</option>
                        <option value="150">150 @L["minutes"]</option>
                        <option value="180">180 @L["minutes"]</option>
                    </select>
                </div>
            </div>

            <!-- Guest-specific fields -->
            <div class="row g-3 mb-3">
                <div class="col-md-4">
                    <label class="form-label fw-semibold">
                        @L["Full Name"] <span style="color: var(--color-primary-red);">*</span>
                    </label>
                    <input name="GuestName" type="text" class="form-control" placeholder="@L["Your name"]" required />
                </div>
                <div class="col-md-4">
                    <label class="form-label fw-semibold">
                        @L["Email"] <span style="color: var(--color-primary-red);">*</span>
                    </label>
                    <input name="GuestEmail" type="email" class="form-control" placeholder="name@example.com" required />
                </div>
                <div class="col-md-4">
                    <label class="form-label fw-semibold">
                        @L["Phone"]
                    </label>
                    <input name="GuestPhone" type="tel" class="form-control" placeholder="+1 555 123 4567" />
                </div>
            </div>

            <div class="form-group mb-3">
                <label class="form-label fw-semibold">
                    <span class="material-symbols-outlined" style="vertical-align: middle; font-size: 1.125rem; margin-right: 0.25rem;">edit_note</span>
                    @L["Reservation Name"] <small style="color: var(--text-muted);">(@L["Optional"])</small>
                </label>
                <input name="ReservationName" type="text" class="form-control" 
                       placeholder="@L["e.g., Birthday Dinner, Anniversary"]" maxlength="100" />
                <small style="display: block; color: var(--text-muted); margin-top: var(--spacing-xs); font-size: 0.875rem;">
                    @L["Give your reservation a memorable name"]
                </small>
            </div>

            <div class="form-group mb-4">
                <label class="form-label fw-semibold">
                    <span class="material-symbols-outlined" style="vertical-align: middle; font-size: 1.125rem; margin-right: 0.25rem;">notes</span>
                    @L["Special Requests"] <small style="color: var(--text-muted);">(@L["Optional"])</small>
                </label>
                <textarea name="Notes" class="form-control" rows="4" 
                          placeholder="@L["Any dietary restrictions or special occasions?"]"></textarea>
            </div>

            <div class="d-flex gap-3 mt-4">
                <a asp-action="Index" asp-controller="Home" class="btn btn-secondary flex-fill">
                    <span class="material-symbols-outlined" style="vertical-align: middle; margin-right: 0.5rem;">cancel</span>
                    @L["Cancel"]
                </a>
                <button type="submit" class="btn btn-confirm flex-fill">
                    <span class="material-symbols-outlined" style="vertical-align: middle; margin-right: 0.5rem;">restaurant</span>
                    @L["Reserve Table"]
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Force dd/MM/yyyy format display for date input
document.addEventListener('DOMContentLoaded', function() {
    const dateInput = document.getElementById('reservationDateInput');
    
    if (dateInput) {
        // Set the lang attribute to force GB locale (dd/MM/yyyy)
        dateInput.setAttribute('lang', 'en-GB');
        
        // Log selected date in dd/MM/yyyy format
        dateInput.addEventListener('change', function() {
            if (this.value) {
                const selectedDate = new Date(this.value + 'T00:00:00');
                const day = String(selectedDate.getDate()).padStart(2, '0');
                const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
                const year = selectedDate.getFullYear();
                console.log(`Selected date: ${day}/${month}/${year}`);
                
                // Display confirmation
                const confirmation = document.getElementById('dateConfirmation');
                if (!confirmation) {
                    const msg = document.createElement('small');
                    msg.id = 'dateConfirmation';
                    msg.style.display = 'block';
                    msg.style.color = 'var(--color-primary-gold)';
                    msg.style.marginTop = 'var(--spacing-xs)';
                    msg.style.fontSize = '0.875rem';
                    msg.style.fontWeight = '600';
                    msg.innerHTML = `? Selected: ${day}/${month}/${year}`;
                    dateInput.parentElement.appendChild(msg);
                } else {
                    confirmation.innerHTML = `? Selected: ${day}/${month}/${year}`;
                }
            }
        });
    }
});
</script>

<style>
/* Force better date input styling */
input[type="date"] {
    position: relative;
}

input[type="date"]::-webkit-calendar-picker-indicator {
    cursor: pointer;
    filter: invert(0.5);
    padding: 5px;
    position: absolute;
    right: 10px;
}

[data-theme="dark"] input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(0.8);
}

input[type="date"]::-webkit-datetime-edit-fields-wrapper {
    padding: 0;
}

input[type="date"]::-webkit-datetime-edit-text {
    color: var(--text-secondary);
    padding: 0 0.2em;
}

input[type="date"]::-webkit-datetime-edit-month-field,
input[type="date"]::-webkit-datetime-edit-day-field,
input[type="date"]::-webkit-datetime-edit-year-field {
    color: var(--text-primary);
    padding: 2px;
}

input[type="date"]::-webkit-datetime-edit-day-field:focus,
input[type="date"]::-webkit-datetime-edit-month-field:focus,
input[type="date"]::-webkit-datetime-edit-year-field:focus {
    background-color: var(--color-primary-gold);
    color: white;
    outline: none;
    border-radius: 3px;
}

/* Ensure proper spacing */
input[type="date"] {
    font-family: inherit;
}
</style>